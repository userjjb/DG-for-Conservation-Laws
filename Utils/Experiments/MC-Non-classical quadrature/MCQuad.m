%Monte Carlo quadrature
clear all

[Qx, Qw]=GLquad(8);
nd=(Qx+1)/2;
Qw=Qw'/2;

fun = @(x) sin(pi*x-pi/2)+1;
fun2 = @(x,A) exp(-(x-.4).^2/A);
fun3= @(x)heaviside(x+0).*exp(-1./(1-(2*(x-.5)).^2)).*heaviside(1-x);
fun4 = @(x) sin(pi*(x+.1));

del=0.01;
r=@(x) x./(x.^2+del^2).^(3/2);

E1=integral(@(x) fun(x).*r(x),0,1,'RelTol',1e-14,'AbsTol',1e-16);
E2=integral(@(x) fun2(x,.05).*r(x),0,1,'RelTol',1e-14,'AbsTol',1e-16);
E3=integral(@(x) fun2(x,.3).*r(x),0,1,'RelTol',1e-14,'AbsTol',1e-16);
E4=integral(@(x) fun3(x).*r(x),0,1,'RelTol',1e-14,'AbsTol',1e-16);
E5=integral(@(x) fun4(x).*r(x),0,1,'RelTol',1e-14,'AbsTol',1e-16);

save=.11;
inc=1;
inc2=1;
while inc2<20E6
    Qx3=sort(rand(8,1));
    if min(diff(Qx3))>0.02
        nn=permute([Qx3(2:8),Qx3([1,3:8]),Qx3([1:2,4:8]),Qx3([1:3,5:8]),Qx3([1:4,6:8]),Qx3([1:5,7:8]),Qx3([1:6,8]),Qx3(1:7)],[2 3 1]);
        Qw3=prod(bsxfun(@rdivide,bsxfun(@minus,nd',nn),bsxfun(@minus,Qx3,nn)),3)*Qw;
        if Qw3>0
            err=max([abs(E1-(fun(Qx3').*r(Qx3'))*Qw3) abs(E2-(fun2(Qx3',.05).*r(Qx3'))*Qw3) abs(E3-(fun2(Qx3',.3).*r(Qx3'))*Qw3) abs(E4-(fun3(Qx3').*r(Qx3'))*Qw3) abs(E5-(fun4(Qx3').*r(Qx3'))*Qw3)]);
            if err<save
                save=err
                QxM(inc,:)=Qx3';
                QwM(inc,:)=Qw3';
                inc=inc+1;
            end
        end
    end
end

%.1174
%[0.00758044647557166,0.0579827548984089,0.210554487734027,0.439753559504884,0.470078281730883,0.699300859253821,0.797196800099694,0.946983882621465;]
%[0.0166112352737959,0.102208129373131,0.196584088661059,0.223862438195038,0.0407553091358209,0.198476714606091,0.0907970325035735,0.130705052251490;]

%.1134
%[0.0135550603829473,0.0901551926122167,0.195284192026745,0.352295539764174,0.662780886615510,0.687312292830270,0.925122065088050,0.973572643775208;]
%[0.0267648493085773,0.155272999189133,0.0268488297993620,0.304114828187270,0.136777511505283,0.177326209211768,0.156872031456029,0.0160227413425773;]

%.1067
%[0.00904955253853990,0.0668264978184583,0.188695114679073,0.361022746185154,0.626208008038280,0.802429808546871,0.902011420133541,0.965672416967471;]
%[0.0186204849552528,0.113284648708347,0.115680519629414,0.246085770772525,0.246551521877827,0.116621713327133,0.0726390360051363,0.0705163047243657;]

%.0877
%[0.0100019366206890,0.0553923489343966,0.157572510599796,0.345140435331641,0.543940229518445,0.732117324437463,0.864548963780254,0.944937172303105;]
%[0.0182281217046348,0.0844484123230403,0.128725705226980,0.230549757739274,0.158545505794867,0.224369535651429,0.0225256134150935,0.132607348144681;]

%.0323
%[0.0102416656563158,0.0717853629985321,0.270109383343779,0.367444573443785,0.547385302479117,0.698468748230208,0.833622761210289,0.970714987883877;]
%[0.0198977035216784,0.130830119885271,0.246726289811717,0.0140463368447291,0.257974748739917,0.0658727025304273,0.186175240124866,0.0784768585413942;]
